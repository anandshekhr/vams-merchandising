{% extends 'base.html' %}
{% load static %}
{% block title %}{{page_title}}{% endblock title %}

{% block body %}
<link rel="stylesheet" href="{% static 'shoppage.css' %}">
<!-- Add your site or application content here -->

<style>
   .alert {
      position: absolute;
      padding: 1rem 1rem;
      margin-bottom: 1rem;
      border: 1px solid transparent;
      border-radius: 0.25rem;
      z-index: 10;
      left: 72%;
      top: 27%;
  }
  .btn-warning-modified {
   font-family: sans-serif;
    color: white;
    font-weight: bold;
    background-color: #fc8955;
    border-color: #fc8955;
}
</style>
   <main>
      {% if messages %}
         {% for message in messages %}
         <div class="alert alert-{{ message.tags }} auto-dismiss" id="err-message">
               <span>
                  <img src="data: image/png; base64, {{product.binaryToStringImage1|safe}}" alt="..." width="65px" height="80px" style="width:auto;">
                  
               </span>
               <span>

                  {{ message }}
               </span>
          </div>
         {% endfor %}
         <script>
            setTimeout(function() {
                  $('.auto-dismiss').fadeOut('slow');
            }, 6000);
         </script> 
      {% endif %}
      <!-- page title area start  -->
      
      <div class="breadcrumb-menu-edit">
         <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}"><span><i class="fa fa-home"></i></span></a></li>
            <li class="breadcrumb-item active"><span>{{product.name}}</span></li>
         </ol>
      </div>
                     
      <!-- page title area end  -->

      <!-- shop details area start  -->
      <section class="shop-details-area pt-120 pb-90">
         <div class="container container-small">
            <div class="row">
               <div class="col-lg-6">
                  <div class="product-details-tab-wrapper mb-30">
                     <div class="product-details-tab">
                        <div class="tab-content" id="productDetailsTab">
                           {% if product.image1 %}
                           <div class="tab-pane fade active show" id="pro-1" role="tabpanel"
                              aria-labelledby="pro-1-tab">
                              <img class="active" src="data: image/png; base64, {{product.binaryToStringImage1|safe}}" alt="...">
                           </div>
                           {% else %}
                           <div class="tab-pane fade active show" id="pro-1" role="tabpanel"
                              aria-labelledby="pro-1-tab">
                              <img class="active" src="{% static 'assets/img/product/no-thumb.jpg' %}" alt="...">
                           </div>
                           {% endif %}
                           {% if product.image2 %}
                           <div class="tab-pane fade" id="pro-2" role="tabpanel" aria-labelledby="pro-2-tab">
                              <img class="active" src="data: image/png; base64, {{product.binaryToStringImage2|safe}}" alt="...">
                           </div>
                           {% endif %}
                           {% if product.image3 %}
                           <div class="tab-pane fade" id="pro-3" role="tabpanel" aria-labelledby="pro-3-tab">
                              <img class="active" src="data: image/png; base64, {{product.binaryToStringImage3|safe}}" alt="...">
                           </div>
                           {% endif %}
                        </div>
                     </div>
                     <div class="product-details-nav">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                           {% if product.image1 %}
                           <li class="nav-item" role="presentation">
                              <button class="nav-link active" id="pro-1-tab" data-bs-toggle="tab"
                                 data-bs-target="#pro-1" type="button" role="tab" aria-controls="pro-1"
                                 aria-selected="false">
                                 <img src="data: image/png; base64, {{product.binaryToStringImage1|safe}}" alt="..." width="65px" height="80px" style="width:auto;">
                              </button>
                           </li>
                           {% else %}
                           <li class="nav-item" role="presentation">
                              <button class="nav-link active" id="pro-1-tab" data-bs-toggle="tab"
                                 data-bs-target="#pro-1" type="button" role="tab" aria-controls="pro-1"
                                 aria-selected="false">
                                 <img src="{% static 'assets/img/product/no-thumb.jpg' %}" alt="..." width="65px" height="80px" style="width:auto;">
                              </button>
                           </li>
                           {% endif %}
                           {% if product.image2 %}
                           <li class="nav-item" role="presentation">
                              <button class="nav-link" id="pro-2-tab" data-bs-toggle="tab" data-bs-target="#pro-2"
                                 type="button" role="tab" aria-controls="pro-2" aria-selected="true">
                                 <img src="data: image/png; base64, {{product.binaryToStringImage2|safe}}" alt="..." width="65px" height="80px" style="width:auto;">
                              </button>
                           </li>
                           {% endif %}
                           {% if product.image3 %}
                           <li class="nav-item" role="presentation">
                              <button class="nav-link" id="pro-3-tab" data-bs-toggle="tab" data-bs-target="#pro-3"
                                 type="button" role="tab" aria-controls="pro-3" aria-selected="false">
                                 <img src="data: image/png; base64, {{product.binaryToStringImage3|safe}}" alt="..." width="65px" height="80px" style="width:auto;">
                              </button>
                           </li>
                           {% endif %}
                        </ul>
                     </div>
                  </div>

               </div>
               <div class="col-lg-6">
                  <div class="product-side-info mb-30">
                     <div class="product-name" style="color:grey;">{{product.brand}}</div>
                     <h4 class="product-name mb-10">{{product.name}}</h4>
                     <span class="product-price">₹{{product.list_price|floatformat:2}}</span>&nbsp;&nbsp;
                     <span class="product-price" style="color: grey;
    text-decoration: line-through;">₹{{product.max_retail_price|floatformat:2}}</span>&nbsp;&nbsp;
                     <span class="product-price" style="color: green;    font-size: medium;">({{product.discount|floatformat:0}}% off)</span>
                     <div class="course-start-icon">
                        {% for i in total_stars %}
                           {% if i  < rating %}
                           <i class="fas fa-star" style='color: #f3da35'></i>
                           {% else %}
                           <i class="fal fa-star"></i>
                           {% endif %}
                        
                        {% endfor %}
                        &nbsp;&nbsp;<a href="#nav-seller"><span style="color: green;">{{total_reviews_count}} Reviews</span></a>
                     </div>

                     <p class="mb-30">{{product.desc.html|safe|slice:50}}</p>
                     <form action="{% url 'add-to-cart-size-qty' product.id %}" method="post" id="add-to-cart-form">{% csrf_token %}
                        <input type="hidden" value="{{product.id}}" id="get-single-product-id">
                        <div class="available-sizes btn-group-toggle" role="group" name="choose-size" id="choose-size">
                           <span>Available Sizes : </span>
                           {% for size in product.available_sizes.all %}
                           <input type="radio" class="btn-check" name="choose-size" id="size-{{size}}" value="{{size}}">
                           <label for="size-{{size}}" class="product-available-sizes btn btn-outline-dark ms-3">{{size}}</label>
                           {% endfor %}
                        </div>
                        <div class="product-quantity-cart mb-25">
                           <div class="product-quantity-form">
                              <button class="cart-minus" id="cart-minus-product" onclick="minusBtnClick('cart-minus-product')"><i class="far fa-minus"></i></button>
                              <input class="cart-input" id="pro-qty" name="pro-qty" type="text" value="1">
                              <button class="cart-plus" onclick="plusBtnClick('cart-plus-product')" id="cart-plus-product"><i class="far fa-plus"></i></button>
                           </div>
                           <button role="submit" class="fill-btn">Add to Cart</button>
                        </div>
                     </form>
                     <a href="{% url 'add-to-wishlist' product.id %}" class="border-btn">Add to Wishlist</a>
                     <div class="product__details__tag tagcloud mt-25 mb-10"><span>Tags : </span>
                        {% for tags in product.tags.all %}
                        <a rel="tag">{{tags}}</a>
                        {% endfor %}
                        
                     </div> 
                     <div>
                        <p class="title_delivery">Delivery Option</p>
                     </div>
                     <div class="custom-search">
                        <input class="custom-search-input" type="text" name="pincode" id="pincode" onkeyup="getPincodeDeliveryValidation(this.value);" placeholder="Enter pincode">
                        <a class="custom-search-botton" type="submit"  onclick="checkPincode()">Check</a>  
                        <div id="pincode-availability-message" class="error-message"></div>
                     </div>
                   
                    
                    <div class="option-group" id="pincodeResult" style="display: none;">
                        <span class="custom-option"><img class="img-options" src="{% static 'assets/img/fast-delivery.png' %}" alt="op-img">Get it by Mon, Oct 16</span>
                        <span class="custom-option"><img class="img-options" src="{% static 'assets/img/cod.png' %}" alt="op-img">Pay on delivery available</span>
                        <span class="custom-option"><img class="img-options" src="{% static 'assets/img/transfer.png' %}" alt="op-img">Easy 14 days return & exchange available</span>
                    </div>
                    
                    <div id="pincodeMessage">
                        <span>Please enter PIN code to check delivery time & Pay on Delivery Availability</span>
                        <br><br>
                        <div>
                            <ul>
                                <li>100% Original Products</li>
                                <li>Pay on delivery might be available</li>
                                <li>Easy 14 days returns and exchanges</li>
                                <li>Try & Buy might be available</li>
                            </ul>
                        </div>
                    </div>
                     {% comment %} <div id="addressPopup" class="overlay" style="display: none;">
                        <div class="popup">
                            <span class="close-button" onclick="closePopup()">&times;</span>
                            <h4 id="popupmaintext" style="color: var(--black, #1C1B1F); font-variant-numeric: lining-nums tabular-nums; font-size: 20px; font-style: normal; font-weight: 500; line-height: 20px;">Select Address</h4>
                            <form id="addressForm">
                                <!-- Replace this section with your dynamic address options -->
                                <div id="SaveaddressForm">
                                 {% for addr in address %}
                                 <label style=" display: flex; flex-direction: row; align-items: center; ">
                                    <input type="radio" name="selectedAddress" value="{{ addr.name }}, {{ addr.pincode }}" onclick="selectAddress('{{ addr.name }}', '{{ addr.address }}','{{addr.addPhoneNumber}}','{{addr.city}}','{{addr.state}}');">
                                    <div class="card-body" style="text-align: start ;display: flex; flex-direction: row; align-items: baseline; gap: 20px;">
                                       <div style="
                                       width: 100%;
                                   ">
                                          <h6 class="card-subtitle mb-2 text-muted" style="color: #000;  font-size: 16px; font-style: normal; font-weight: 400; line-height: normal;">
                                             <span>Deliver to:</span> {{ addr.name }}, {{ addr.pincode }}
                                          </h6>
                                          <h5 class="card-title" style="color: #000;  font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
                                             Address: {{ addr.user_address }}
                                          </h5>
                                          <h5 class="card-title" style="color: #000;  font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
                                             Phone: {{ addr.addPhoneNumber }}
                                          </h5>
                                       </div>
                                       <div>
                                          <span class="addrType_chip">{{addr.address_type}}</span>
                                       </div>
                                    </div>
                                 </label>
                                 {% endfor %}
                                </div>
                            </form>
                        </div>
                    </div> {% endcomment %}
                  </div>
               </div>
            </div>
            
               <script>
                  function checkPincode() {
                      var pincode = document.getElementById("pincode").value;
                      var pincodeResult = document.getElementById("pincodeResult");
                      var pincodeMessage = document.getElementById("pincodeMessage");
              
                      // Check if the entered PIN code is exactly 6 digits
                      if (pincode.length === 6 && /^\d+$/.test(pincode)) {
                          // Show the result and hide the message
                          pincodeResult.style.display = "block";
                          pincodeMessage.style.display = "none";
                      } else {
                          // Show the message and hide the result
                          pincodeResult.style.display = "none";
                          pincodeMessage.style.display = "block";
                      }
                  }
              </script>
              <script>
               function getPincodeDeliveryValidation(value) {
                   var domain = window.location.origin;
                   $.ajax({
                       url: domain + '/stores/location-availability/',
                       type: 'GET',
                       data: {
                           pincode: value
                       },
                       success: function (response) {
                           document.getElementById("pincode-availability-message").textContent = "";
                           if (response.available == true) {
                               document.getElementById("pincode-availability-message").textContent = "Hurray! We are delivering at this location.";
                           }
                           else {
                               document.getElementById("pincode-availability-message").textContent = "OOPS! We are currently not delivering at this location.";
                           }
                       }
                   });
               }
           </script>
           
           

            {% comment %} <script>
               function showAddressPopup() {
                   var addressPopup = document.getElementById("addressPopup");
                   addressPopup.style.display = "block";
               }
       
               function closePopup() {
                   var addressPopup = document.getElementById("addressPopup");
                   addressPopup.style.display = "none";
               }
       
               function selectAddress(name) {
                   // Handle the selected address here
                   console.log("Selected address: " + name);
                   closePopup(); // Close the popup after selection if needed
               }
           </script> {% endcomment %}
            <!--reviews-->
            <div class="product_info-faq-area pb-0">
               <div class="">
                  <nav class="product-details-nav">
                     <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link show" id="nav-general-tab" data-bs-toggle="tab" href="#nav-general"
                           role="tab" aria-selected="false">Description</a>
                        <a class="nav-item nav-link active" id="nav-seller-tab" data-bs-toggle="tab" href="#nav-seller"
                           role="tab" aria-selected="true">Reviews</a>
                     </div>
                  </nav>
                  <div class="tab-content product-details-content" id="nav-tabContent">
                     <div class="tab-pane fade" id="nav-general" role="tabpanel">
                        <div class="tabs-wrapper mt-35">
                           <div class="product__details-des">
                              <p>{{product.desc.html|safe}}</p>
                           </div>
                        </div>
                     </div>
                     <div class="tab-pane fade active show" id="nav-seller" role="tabpanel">
                        <div class="tabs-wrapper mt-35">
                           {% for review in reviews %}
                           <div class="course-review-item mb-30">
                              <div class="course-reviews-img">
                                 {% if review.auther.avatar %}
                                 <a><img src="/media/{{review.auther.avatar}}"
                                       alt="image not found" style="width:50px;"></a>
                                 {% else %}
                                 <a><img src="{% static 'assets/img/dashboard/profile.png' %}"
                                       alt="image not found" style="width:50px;"></a>
                                 {% endif %}
                                 
                              </div>
                              <div class="course-review-list">
                                 <h5><a href="#">{{review.author.user_full_name}}</a></h5>
                                 <div class="course-start-icon">
                                    {% for i in total_stars %}
                                       {% if i  < review.ratings %}
                                       <i class="fas fa-star"></i>
                                       {% else %}
                                       <i class="fal fa-star"></i>
                                       {% endif %}
                                    
                                    {% endfor %}
                                    <span>{{review.review_date}}</span>
                                 </div>
                                 <p>{{review.review}}</p>
                              </div>
                           </div>
                           {% empty %}
                           <p>No Reviews</p>
                           {% endfor %}
                           <div class="product__details-comment ">
                              <div class="comment-title mb-20">
                                 <h3>Add a review</h3>
                                 {% comment %} <p>Your email address will not be published. Required fields are marked *</p> {% endcomment %}
                              </div>
                              <span>Overall ratings: </span>
                              <div class="comment-rating mb-20" data-rating="{{ user_rating }}">
                                    <span class="star" data-value="1"></span>
                                    <span class="star" data-value="2"></span>
                                    <span class="star" data-value="3"></span>
                                    <span class="star" data-value="4"></span>
                                    <span class="star" data-value="5"></span>
                              </div>
                              <div class="comment-input-box mb-20">
                                 <form action="" id="submit-review-form">{% csrf_token %}
                                    <div class="row">
                                       <div class="col-xxl-12">
                                          <textarea placeholder="Your review"
                                             class="comment-input comment-textarea mb-20" id="product-review"></textarea>
                                       </div>
                                       <div class="col-xxl-6">
                                          <div class="comment-input mb-20">
                                             <input type="text" placeholder="Your Name" id="user-author" style="display:None;" value="{{request.user.id}}">
                                          </div>
                                       </div>
                                       <div class="col-xxl-6">
                                          <div class="comment-input mb-20">
                                             <input type="text" placeholder="" id="product-id" value="{{product.id}}" style="display:None;">
                                          </div>
                                       </div>
                                       <div class="col-xxl-12">
                                          <div class="comment-submit">
                                             <button type="submit" class="fill-btn">Submit</button>
                                          </div>
                                       </div>
                                    </div>
                                 </form>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </section>
      <!-- shop details area end  -->

      <div class="related_product pb-70">
         <div class="container container-small">
            <div class="section-title mb-55">
               <h2>Related Product</h2>
            </div>
            <!-- Slider main container -->
            <div class="swiper-container r-product-active">
               <!-- Additional required wrapper -->
               <div class="swiper-wrapper">
                  {% for product in related_products %}
                  <div class="swiper-slide">
                        {% comment %} {% if 'best-seller' in product.category %} {% endcomment %}
                        <div class="single-product-st2">
                           <div class="product-image pos-rel">
                              <a href="{% url 'productdetail' subcategory=product.subcategory.all.first.subcategory_code slug=product.slug %}" class=""><img src="data: image/png; base64, {{product.binaryToStringImage1|safe}}" alt="img"  width="265px" height="390px"></a>
                              
                              <div class="product-action-bottom">
                                 <a href="{% url 'productdetail' subcategory=product.subcategory.all.first.subcategory_code slug=product.slug %}" class="quick-view-btn"><i class="fal fa-eye"></i></a>
                                 <a class="wishlist-btn" id="wishlist-{{product.id}}"><i class="fal fa-heart"></i></a>
                              </div>
                              {% if product.discount %}
                              <div class="product-sticker-wrapper">
                                 <span class="product-sticker discount">-{{product.discount|floatformat:0}}%</span>
                              </div>
                              {% else %}
                              <div class="product-sticker-wrapper">
                                 <span class="product-sticker new">New</span>
                              </div>
                              {% endif %}
                           </div>
                           <div class="product-desc">
                              <div class="product-name" style="color:grey;">{{product.brand}}</div>
                              <div class="product-name"><a href="{% url 'productdetail' subcategory=product.subcategory.all.first.subcategory_code slug=product.slug %}">{{product.name}}</a></div>
                              <div class="product-price">
                                 <span class="price-now">₹{{product.list_price|floatformat:2}}</span>
                                 <span class="price-old">₹{{product.max_retail_price|floatformat:2}}</span>
                              </div>
                              <ul class="product-color-nav">
                                 {% for image in pr_images %}
                                    {% if image.product.id == product.id %}
                                    <li class="cl-{{image.image_thumbnail_color}} active">
                                       <img src="/media/{{image.images}}" alt="img">
                                    </li>
                                    {% endif %}
                                 {% endfor %}
                              </ul>
                           </div>
                        </div>
                        {% comment %} {% endif %} {% endcomment %}
                     </div>
                 {% endfor %}
               </div>
               <!-- If we need pagination -->
               <div class="testimonial-pagination text-center"></div>
               <span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>
            </div>
         </div>
      </div>
   </main>
   


{% endblock body %}